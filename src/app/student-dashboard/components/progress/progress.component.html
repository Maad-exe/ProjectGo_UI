<div class="progress-container">
  <div class="section-header">
    <h2>
      <i class="fas fa-chart-line"></i>
      My Evaluation Progress
    </h2>
    <p class="section-description">Track your performance across all evaluation events</p>
  </div>

  <!-- Loading state -->
  <div class="loading-state" *ngIf="isLoading">
    <i class="fas fa-spinner fa-spin"></i>
    <p>Loading your evaluations...</p>
  </div>

  <!-- Empty state -->
  <div class="empty-state" *ngIf="!isLoading && evaluations.length === 0">
    <i class="fas fa-clipboard-list"></i>
    <h3>No Evaluations Yet</h3>
    <p>You haven't been evaluated in any events yet. Check back later!</p>
  </div>

  <!-- Progress content -->
  <div class="progress-content" *ngIf="!isLoading && evaluations.length > 0">
    <!-- Summary card -->
    <div class="summary-card">
      <div class="grade-circle" [ngClass]="getGradeColor(finalGrade)">
        <div class="grade-value">{{ finalGrade | number:'1.1-1' }}</div>
        <div class="grade-label">Overall Grade</div>
      </div>
      
      <div class="summary-details">
        <h3>Your Overall Performance</h3>
        <p>Based on {{ evaluations.length }} evaluation events</p>
        
        <div class="status-indicator" [ngClass]="getGradeColor(finalGrade)">
          <span class="status-label">
            <ng-container [ngSwitch]="getGradeColor(finalGrade)">
              <ng-container *ngSwitchCase="'excellent'">Excellent</ng-container>
              <ng-container *ngSwitchCase="'good'">Good</ng-container>
              <ng-container *ngSwitchCase="'average'">Satisfactory</ng-container>
              <ng-container *ngSwitchCase="'needs-improvement'">Needs Improvement</ng-container>
            </ng-container>
          </span>
        </div>
      </div>
    </div>

    <!-- Evaluations list -->
    <div class="evaluations-list">
      <h3>Evaluation Details</h3>
      
      <div class="evaluation-card" *ngFor="let evaluation of evaluations">
        <div class="event-info">
          <h4>{{ evaluation.eventName }}</h4>
          <div class="event-meta">
            <span class="event-type">{{ evaluation.eventType || 'Standard' }}</span>
            <span class="event-date">{{ evaluation.eventDate | date }}</span>
            <span class="event-weight">Weight: {{ evaluation.eventWeight || 0 }}%</span>
          </div>
        </div>
        
        <!-- Evaluation details section - show if we have any details to show -->
        <div class="evaluation-details" *ngIf="hasEvaluationDetails(evaluation)">
          <div class="score-value" [ngClass]="getGradeColor(evaluation.obtainedMarks)">
            {{ evaluation.obtainedMarks }}
            <span class="score-max">/ {{ evaluation.totalMarks }}</span>
          </div>
          
          <!-- Score percentage visualization -->
          <div class="score-progress">
            <div class="progress-bar">
              <div class="progress-fill" 
                   [ngClass]="getGradeColor(evaluation.obtainedMarks)" 
                   [style.width]="getProgressBarWidth(calculatePercentage(evaluation.obtainedMarks, evaluation.totalMarks))">
              </div>
            </div>
            <div class="progress-label">{{ calculatePercentage(evaluation.obtainedMarks, evaluation.totalMarks) | number:'1.0-0' }}%</div>
          </div>
          
          <!-- For rubric-based evaluations, show category details -->
          <div class="rubric-details" *ngIf="evaluation.categoryScores && evaluation.categoryScores.length > 0">
            <h5>Evaluation Details by Category</h5>
            <div class="table-responsive">
              <table class="table table-sm">
                <thead>
                  <tr>
                    <th>Category</th>
                    <th>Weight</th>
                    <th>Score</th>
                    <th>Comments</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let category of evaluation.categoryScores">
                    <td>{{ category.categoryName }}</td>
                    <td>{{ category.categoryWeight }}%</td>
                    <td>
                      <div class="score-pill" [ngClass]="getGradeColor(calculatePercentage(category.score, category.maxScore))">
                        {{ category.score }}/{{ category.maxScore }}
                      </div>
                    </td>
                    <td>{{ category.feedback || 'No comments provided' }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          
          <!-- Panel evaluation status -->
          <div class="panel-status" *ngIf="evaluation.evaluators && evaluation.evaluators.length > 0">
            <h5>Panel Evaluation Status</h5>
            <div class="panel-completion">
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width]="getProgressBarWidth(getPanelCompletionPercentage(evaluation))">
                </div>
              </div>
              <div class="progress-label">{{ getPanelCompletionPercentage(evaluation) | number:'1.0-0' }}% Complete</div>
            </div>
            
            <div class="evaluators">
              <h6>Evaluators:</h6>
              <ul class="evaluator-list">
                <li *ngFor="let evaluator of evaluation.evaluators" 
                    [class.completed]="evaluator?.hasEvaluated">
                  <span class="evaluator-name">{{ evaluator?.name || 'Unknown Evaluator' }}</span>
                  <span class="evaluator-status" [ngClass]="evaluator?.hasEvaluated ? 'completed' : 'pending'">
                    {{ evaluator?.hasEvaluated ? 'Completed' : 'Pending' }}
                  </span>
                  <span class="evaluator-score" *ngIf="evaluator?.hasEvaluated">
                    Score: {{ evaluator?.score || 'N/A' }}
                  </span>
                </li>
                <!-- Show a message if no evaluators are present -->
                <li *ngIf="!evaluation.evaluators || evaluation.evaluators.length === 0">
                  No evaluator information available
                </li>
              </ul>
            </div>
          </div>
          
          <!-- Evaluation feedback -->
          <div class="evaluation-feedback" *ngIf="evaluation.feedback">
            <h5>Feedback:</h5>
            <div class="feedback-content">
              <i class="fas fa-quote-left"></i>
              <p>{{ evaluation.feedback }}</p>
            </div>
          </div>
        </div>
        
        <!-- Pending evaluation message - only show if NO details available -->
        <div class="pending-message" *ngIf="!hasEvaluationDetails(evaluation)">
          <i class="fas fa-hourglass-half"></i>
          <p>Evaluation in progress</p>
          
          <!-- Show details about panel progress if available -->
          <div class="panel-progress" *ngIf="evaluation.evaluators && evaluation.evaluators.length > 0">
            <div class="panel-completion">
              <div class="progress-bar">
                <div class="progress-fill" 
                     [style.width]="getProgressBarWidth(getPanelCompletionPercentage(evaluation))">
                </div>
              </div>
              <div class="progress-label">{{ getPanelCompletionPercentage(evaluation) | number:'1.0-0' }}% Complete</div>
            </div>
            
            <div class="evaluators-status">
              <h6>Pending evaluations from:</h6>
              <ul>
                <ng-container *ngIf="evaluation.evaluators && evaluation.evaluators.length > 0">
                  <li *ngFor="let evaluator of evaluation.evaluators">
                    <ng-container *ngIf="!evaluator?.hasEvaluated">
                      {{ evaluator?.name || 'Unknown Evaluator' }}
                    </ng-container>
                  </li>
                  <!-- Show a message if all evaluators have completed -->
                  <li *ngIf="areAllEvaluationsCompleted(evaluation)">
                    All evaluators have completed their assessments
                  </li>
                </ng-container>
                <li *ngIf="!evaluation.evaluators || evaluation.evaluators.length === 0">
                  No evaluator information available
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
