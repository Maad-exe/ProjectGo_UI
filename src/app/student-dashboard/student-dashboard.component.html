<div class="dashboard-container">
  <!-- Move topbar outside main-wrapper -->
  <header class="topbar">
    <!-- Add logo to topbar -->
    <div class="brand-section">
      <div class="logo">
        <span class="logo-text">ProjectGo</span>
        <div class="logo-dot"></div>
      </div>
    </div>

    <div class="search-bar">
      <i class="fas fa-search"></i>
      
      <input type="text" placeholder="Search...">
    </div>
    
    <div class="user-info">
      <div class="user-details">
        <h3>{{studentInfo.fullName}}</h3>
        <div class="user-meta">
          <span class="enrollment" title="Enrollment Number">
            <i class="fas fa-id-card"></i>
            {{studentInfo.enrollmentNumber}}
          </span>
          <span class="department" title="Department">
            <i class="fas fa-building-columns"></i>
            {{studentInfo.department}}
          </span>
          <span class="email" title="Email">
            <i class="fas fa-envelope"></i>
            {{studentInfo.email}}
          </span>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()" title="Sign out">
        <i class="fas fa-sign-out-alt"></i>
        <span>Sign out</span>
      </button>
    </div>
  </header>

  <aside class="sidebar">
    <!-- Remove brand-section from sidebar -->
    <nav class="sidebar-nav">
      <a class="nav-item" [class.active]="currentView === 'dashboard'" (click)="setView('dashboard')">
        <i class="fas fa-home"></i>
        <span>Dashboard</span>
      </a>
      <a class="nav-item" [class.active]="currentView === 'teachers'" (click)="setView('teachers')">
        <i class="fas fa-chalkboard-teacher"></i>
        <span>Browse Supervisors</span>
      </a>
      <a class="nav-item" [class.active]="currentView === 'projects'" (click)="setView('projects')">
        <i class="fas fa-tasks"></i>
        <span>Project Management</span>
      </a>
      <a class="nav-item" [class.active]="currentView === 'proposals'" (click)="setView('proposals')">
        <i class="fas fa-file-alt"></i>
        <span>Submit Proposal</span>
      </a>
      <a class="nav-item" [class.active]="currentView === 'groups'" (click)="setView('groups')">
        <i class="fas fa-users"></i>
        <span>My Groups</span>
      </a>
    </nav>
  </aside>

  <div class="main-wrapper">
    
    <main class="main-content">
      <!-- Dashboard View -->
      <div class="dashboard-welcome" *ngIf="currentView === 'dashboard'">
        <div class="welcome-card">
          <h1>Welcome to Student Dashboard</h1>
          <p class="subtitle">Access all your academic resources in one place</p>
          <div class="quick-actions">
            <button class="action-btn" (click)="setView('teachers')">
              <i class="fas fa-users"></i>
              View Faculty
            </button>
            <button class="action-btn">
              <i class="fas fa-book"></i>
              My Courses
            </button>
            <button class="action-btn">
              <i class="fas fa-calendar"></i>
              Schedule
            </button>
          </div>
        </div>
      </div>

      <!-- Teachers List View -->
      <div class="teacher-section" *ngIf="currentView === 'teachers'">
        <div class="section-header">
          <h2 class="section-title">Our Distinguished Faculty</h2>
          <p class="section-subtitle">Meet our experienced team of educators</p>
        </div>

        <!-- Loading State -->
        <div class="loading-state" *ngIf="isLoading">
          <i class="fas fa-spinner fa-spin"></i> Loading faculty details...
        </div>

        <!-- Error State -->
        <div class="error-state" *ngIf="error">
          {{ error }}
          <button class="retry-btn" (click)="loadTeachers()">Retry</button>
        </div>

        <!-- Teachers Grid -->
        <div class="teacher-grid" *ngIf="!isLoading && !error && teachers.length > 0">
          <div class="teacher-card" *ngFor="let teacher of teachers">
            <div class="card-header">
              <div class="teacher-avatar">
                <i class="fas fa-user-tie"></i>
              </div>
              <div class="teacher-primary-info">
                <h3>{{teacher.fullName}}</h3>
                <span class="department">Computer Science Department</span>
              </div>
            </div>
            <div class="card-body">
              <div class="info-section">
                <h4>Specialization</h4>
                <p>{{teacher.areaOfSpecialization}}</p>
              </div>
              <div class="info-section">
                <h4>Qualification</h4>
                <p>{{teacher.qualification}}</p>
              </div>
              <div class="contact-details">
                <a href="mailto:{{teacher.email}}" class="contact-item">
                  <i class="fas fa-envelope"></i>
                  <span>{{teacher.email}}</span>
                </a>
                <div class="contact-item">
                  <i class="fas fa-location-dot"></i>
                  <span>{{teacher.officeLocation}}</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Group Management View -->
      <div class="group-section" *ngIf="currentView === 'groups'">
        <div class="section-header">
          <h2 class="section-title">My Groups</h2>
          <p class="section-subtitle">Manage your project groups</p>
        </div>

        <button class="create-group-btn" (click)="showCreateGroupForm()" *ngIf="!showGroupForm">
          <i class="fas fa-plus-circle"></i> Create New Group
        </button>

        <!-- Create Group Form -->
        <div class="create-group-form" *ngIf="showGroupForm">
          <form [formGroup]="createGroupForm" (ngSubmit)="createGroup()">
            <div class="form-group">
              <label for="groupName">Group Name:</label>
              <input type="text" id="groupName" formControlName="groupName" placeholder="Enter group name">
            </div>

            <div class="form-group">
              <label for="memberCount">Number of Members:</label>
              <select id="memberCount" formControlName="memberCount" (change)="onMemberCountChange()">
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
              </select>
            </div>

            <div class="form-group" *ngFor="let control of memberEmails.controls; let i = index">
              <label for="memberEmail{{i}}">Member {{i + 1}} Email:</label>
              <div class="search-input-group">
                <input type="email" id="memberEmail{{i}}" [formControl]="control" #emailControl="ngForm" placeholder="Enter member email">
                <button type="button" (click)="searchStudent(control.value, i)" [disabled]="isSearchingStudent">
                  <i class="fas fa-search"></i>
                </button>
              </div>
              <div *ngIf="searchErrors[control.value]" class="error-message">
                {{searchErrors[control.value]}}
              </div>
              <div *ngIf="studentSearchResults[control.value]" class="student-info">
                {{studentSearchResults[control.value]?.fullName}} ({{studentSearchResults[control.value]?.email}})
              </div>
            </div>

            <button type="submit" class="submit-btn" [disabled]="createGroupForm.invalid || isCreatingGroup">
              <i class="fas fa-check-circle"></i> {{ isCreatingGroup ? 'Creating...' : 'Create Group' }}
            </button>
            <div *ngIf="groupCreationError" class="error-message">
              {{groupCreationError}}
            </div>
          </form>
        </div>

        <!-- Display Groups -->
        <div class="group-list" *ngIf="groups.length > 0">
          <div class="group-card" *ngFor="let group of groups">
            <h3>{{group.name}}</h3>
            <p>Created at: {{group.createdAt | date}}</p>
            <h4>Members:</h4>
            <ul>
              <li *ngFor="let member of group.members">
                {{member.fullName}} ({{member.email}})
              </li>
            </ul>
          </div>
        </div>
        <div class="no-data" *ngIf="groups.length === 0 && !showGroupForm">
          No groups created yet.
        </div>
      </div>
    </main>
  </div>
</div>